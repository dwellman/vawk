#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"
JAR_PATH="${VAWK_JAR:-}"

if [[ -z "$JAR_PATH" ]]; then
  JAR_PATH=$(ls -t "$ROOT_DIR"/target/vawk-*.jar 2>/dev/null | head -n1 || true)
fi

if [[ -z "$JAR_PATH" ]]; then
  echo "VAWK jar not found in $ROOT_DIR/target." >&2
  echo "Build it with: mvn -q package spring-boot:repackage" >&2
  exit 1
fi

JAVA_CMD="${VAWK_JAVA:-java}"
JAVA_OPTS="${VAWK_JAVA_OPTS:-}"

SPRING_MAIN_WEB_APPLICATION_TYPE="${SPRING_MAIN_WEB_APPLICATION_TYPE:-none}" \
exec "$JAVA_CMD" $JAVA_OPTS -jar "$JAR_PATH" "$@"
